{% extends 'base.html' %}
{% block titulo %}Historial de Movimientos{% endblock titulo %}

{% block content %}
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2>Historial de Movimientos</h2>
        <a href="{% url 'movimiento_create' %}" class="btn btn-primary">
            <i class="bi bi-plus-circle"></i> Registrar Nuevo Movimiento
        </a>
    </div>

    {% include 'partials/messages.html' %}

    {% if movimientos %}
        <table id="tablaMovimientos" class="table table-striped table-hover shadow-sm">
            <thead class="table-dark">
                <tr>
                    <th>Fecha</th>
                    <th>Producto</th>
                    <th>Tipo</th>
                    <th>Cantidad</th>
                    <th>Responsable</th>
                    <th>Descripción</th>
                </tr>
            </thead>
            <tbody>
                {% for movimiento in movimientos %}
                <tr class="{% if movimiento.tipo == 'SALIDA' %}table-danger{% else %}table-success{% endif %}">
                    <td>{{ movimiento.fecha_movimiento|date:"d/m/Y H:i" }}</td>
                    <td>{{ movimiento.producto.nombre }}</td>
                    <td>{{ movimiento.get_tipo_display }}</td>
                    <td>{{ movimiento.cantidad }}</td>
                    <td>
                        {% if movimiento.responsable %}
                            {{ movimiento.responsable.nombre }} {{ movimiento.responsable.apellido }}
                        {% else %}
                            Sin responsable
                        {% endif %}
                    </td>
                    <td>{{ movimiento.descripcion|default:"Sin descripción" }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <div class="alert alert-info" role="alert">
            No hay movimientos registrados.
        </div>
    {% endif %}
</div>

<!-- Librerías de DataTables -->
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.5/css/jquery.dataTables.min.css">
<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.5/js/jquery.dataTables.min.js"></script>

<script>
$(document).ready(function() {
    $('#tablaMovimientos').DataTable({
        "pageLength": 10,             // cantidad de filas por página
        "order": [[0, "desc"]],       // ordenar por Fecha descendente
        "language": {                 // traducción a español
            "search": "Buscar:",
            "lengthMenu": "Mostrar _MENU_ registros",
            "info": "Mostrando _START_ a _END_ de _TOTAL_ registros",
            "paginate": {
                "first": "Primero",
                "last": "Último",
                "next": "Siguiente",
                "previous": "Anterior"
            },
            "zeroRecords": "No se encontraron resultados"
        }
    });
});
</script>

{% endblock content %}
